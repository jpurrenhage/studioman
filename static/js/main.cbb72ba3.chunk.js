(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{212:function(e,t,n){e.exports=n.p+"static/media/loading.c5590569.svg"},219:function(e,t,n){e.exports=n(400)},304:function(e,t,n){},381:function(e,t,n){},400:function(e,t,n){"use strict";n.r(t);var a=n(17),r=n.n(a),c=(n(304),n(305),n(1)),l=n.n(c),o=n(403),i=n(404),u=n(42),s=n(43),h=n(68),d=n(66),m=n(69),p=n(25),E=(n(381),function(e){function t(){return Object(u.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"goTo",value:function(e){this.props.history.replace("/".concat(e))}},{key:"login",value:function(){this.props.auth.login()}},{key:"logout",value:function(){this.props.auth.logout()}},{key:"componentDidMount",value:function(){var e=this.props.auth.renewSession;"true"===localStorage.getItem("isLoggedIn")&&e()}},{key:"render",value:function(){var e=this.props.auth.isAuthenticated;return l.a.createElement("div",null,l.a.createElement(p.c,{fluid:!0},l.a.createElement(p.c.Header,null,l.a.createElement(p.c.Brand,null,l.a.createElement("a",{href:"/"},"StudioMan")),l.a.createElement(p.a,{bsStyle:"primary",className:"btn-margin",onClick:this.goTo.bind(this,"home")},"Home"),!e()&&l.a.createElement(p.a,{id:"qsLoginBtn",bsStyle:"primary",className:"btn-margin",onClick:this.login.bind(this)},"Log In"),e()&&l.a.createElement(p.a,{id:"qsLogoutBtn",bsStyle:"primary",className:"btn-margin",onClick:this.logout.bind(this)},"Log Out"))))}}]),t}(c.Component)),g=n(147),f=n.n(g),b=n(207),k=n(217),v=n(46),y=n(67),j=n(41),A=n.n(j);function C(){var e=Object(y.a)(["",""]);return C=function(){return e},e}var w=function(e){return l.a.createElement(v.b,{query:A()(C(),"\nquery {\n  user {\n    id\n    email\n    name\n    status\n    image_url\n  }\n}")},function(t){var n=t.loading,a=t.error,r=t.data;return n?l.a.createElement("p",null,"Loading..."):a?l.a.createElement("p",null,"Error :("):l.a.createElement(p.d,{striped:!0,bordered:!0,hover:!0},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null),l.a.createElement("th",null,"User Name"),l.a.createElement("th",null,"Email"),l.a.createElement("th",null,"Status"))),l.a.createElement("tbody",null,r.user.map(function(t){return l.a.createElement("tr",{key:t.id,onClick:e.onClick(t)},l.a.createElement("td",null,l.a.createElement(p.b,{src:t.image_url,thumbnail:!0})),l.a.createElement("td",null,t.name),l.a.createElement("td",null,t.email),l.a.createElement("td",null,t.status))})))})};function O(){var e=Object(y.a)(["",""]);return O=function(){return e},e}var T=function(e){return l.a.createElement(v.b,{query:A()(O(),"\nquery fetch_accountsForUser($userId: Int!) {\n  account_aggregate(\n    where: {user_id: {_eq: $userId} }\n  ) {\n    nodes {\n      id\n      name\n      type\n      status\n    }\n  }\n}"),variables:{userId:e.user.id}},function(t){var n=t.loading,a=t.error,r=t.data;return n?l.a.createElement("p",null,"Loading..."):a?l.a.createElement("p",null,"Error :("):l.a.createElement("div",null,l.a.createElement("h4",null,"Accounts for ",e.user.name),l.a.createElement(p.d,{striped:!0,bordered:!0,hover:!0},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"Account Name"),l.a.createElement("th",null,"Type"),l.a.createElement("th",null,"Status"))),l.a.createElement("tbody",null,r.account_aggregate.nodes.map(function(t){return l.a.createElement("tr",{key:t.id,onClick:e.onClick(t)},l.a.createElement("td",null,t.name),l.a.createElement("td",null,t.type),l.a.createElement("td",null,t.status))}))))})};function I(){var e=Object(y.a)(["",""]);return I=function(){return e},e}var _=function(e){return l.a.createElement(v.b,{query:A()(I(),"\nquery fetch_projectsForAccount($accountId: Int!) {\n  project_aggregate(\n    where: {owner_id: {_eq: $accountId}}\n  ) {\n    nodes {\n      id\n      name\n      project_customer {\n        name\n      }\n      type\n      start_date\n      due_date\n      completion_date\n      description\n    }\n  }\n}"),variables:{accountId:e.account.id}},function(t){var n=t.loading,a=t.error,r=t.data;return n?l.a.createElement("p",null,"Loading..."):a?l.a.createElement("p",null,"Error :("):l.a.createElement("div",null,l.a.createElement("h4",null,"Projects for Account ",e.account.name),l.a.createElement(p.d,{striped:!0,bordered:!0,hover:!0},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"Project Name"),l.a.createElement("th",null,"Customer"),l.a.createElement("th",null,"Type"),l.a.createElement("th",null,"Start Date"),l.a.createElement("th",null,"Due Date"),l.a.createElement("th",null,"Completion Date"))),l.a.createElement("tbody",null,r.project_aggregate.nodes.map(function(t){return l.a.createElement("tr",{key:t.id,onClick:e.onClick(t)},l.a.createElement("td",null,t.name),l.a.createElement("td",null,t.project_customer.name),l.a.createElement("td",null,t.type),l.a.createElement("td",null,t.start_date),l.a.createElement("td",null,t.due_date),l.a.createElement("td",null,t.completion_date))}))))})},S=new k.a({uri:"https://artemis.onlinebands.com/v1alpha1/graphql",fetchOptions:{credentials:"include"},request:function(){var e=Object(b.a)(f.a.mark(function e(t){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:"artemis-audio-database",t.setContext({headers:{"X-Hasura-Admin-Secret":"artemis-audio-database"}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}),q=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={currentUser:null,currentAccount:null},n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"setCurrentUser",value:function(e){this.setState({currentUser:e,currentAccount:null})}},{key:"setCurrentAccount",value:function(e){this.setState({currentAccount:e})}},{key:"login",value:function(){this.props.auth.login()}},{key:"render",value:function(){var e=this,t=this.props.auth.isAuthenticated;return l.a.createElement("div",{className:"container"},t()&&l.a.createElement("div",{className:"container"},l.a.createElement(v.a,{client:S},l.a.createElement("div",null,l.a.createElement("h2",null,"StudioMan"),l.a.createElement(w,{onClick:function(t){return function(n){return e.setCurrentUser(t)}}}),this.state.currentUser&&l.a.createElement(T,{user:this.state.currentUser,onClick:function(t){return function(n){return e.setCurrentAccount(t)}}}),this.state.currentAccount&&l.a.createElement(_,{account:this.state.currentAccount,onClick:function(e){return function(t){return console.log("clicked project:",e)}}})))),!t()&&l.a.createElement("h4",null,"You are not logged in! Please"," ",l.a.createElement("button",{style:{cursor:"pointer"},onClick:this.login.bind(this)},"Log In")," ","to continue."))}}]),t}(c.Component),U=n(212),L=n.n(U),x=function(e){function t(){return Object(u.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return l.a.createElement("div",{style:{position:"absolute",display:"flex",justifyContent:"center",height:"100vh",width:"100vw",top:0,bottom:0,left:0,right:0,backgroundColor:"white"}},l.a.createElement("img",{src:L.a,alt:"loading"}))}}]),t}(c.Component),D=n(213),N=n.n(D)()(),H=n(214),B={domain:"studioman.auth0.com",clientId:"kbHqtaePCSGY2WdQYpM1H4g425JxR1UQ",callbackUrl:"https://jpurrenhage.github.io/studioman/callback"},M=new(function(){function e(){Object(u.a)(this,e),this.auth0=new H.a.WebAuth({domain:B.domain,clientID:B.clientId,redirectUri:B.callbackUrl,responseType:"token id_token",scope:"openid"}),this.login=this.login.bind(this),this.logout=this.logout.bind(this),this.handleAuthentication=this.handleAuthentication.bind(this),this.isAuthenticated=this.isAuthenticated.bind(this),this.getAccessToken=this.getAccessToken.bind(this),this.getIdToken=this.getIdToken.bind(this),this.renewSession=this.renewSession.bind(this)}return Object(s.a)(e,[{key:"login",value:function(){this.auth0.authorize()}},{key:"handleAuthentication",value:function(){var e=this;this.auth0.parseHash(function(t,n){n&&n.accessToken&&n.idToken?e.setSession(n):t&&(N.replace("/home"),console.log(t),alert("Error: ".concat(t.error,". Check the console for further details.")))})}},{key:"getAccessToken",value:function(){return this.accessToken}},{key:"getIdToken",value:function(){return this.idToken}},{key:"setSession",value:function(e){localStorage.setItem("isLoggedIn","true");var t=1e3*e.expiresIn+(new Date).getTime();this.accessToken=e.accessToken,this.idToken=e.idToken,this.expiresAt=t,N.replace("/home")}},{key:"renewSession",value:function(){var e=this;this.auth0.checkSession({},function(t,n){n&&n.accessToken&&n.idToken?e.setSession(n):t&&(e.logout(),console.log(t))})}},{key:"logout",value:function(){this.accessToken=null,this.idToken=null,this.expiresAt=0,localStorage.removeItem("isLoggedIn"),this.auth0.logout({return_to:window.location.origin}),N.replace("/home")}},{key:"isAuthenticated",value:function(){var e=this.expiresAt;return(new Date).getTime()<e}}]),e}()),P=l.a.createElement(o.a,{history:N},l.a.createElement("div",null,l.a.createElement(i.a,{path:"/",render:function(e){return l.a.createElement(E,Object.assign({auth:M},e))}}),l.a.createElement(i.a,{path:"/home",render:function(e){return l.a.createElement(q,Object.assign({auth:M},e))}}),l.a.createElement(i.a,{path:"/callback",render:function(e){return function(e){var t=e.location;/access_token|id_token|error/.test(t.hash)&&M.handleAuthentication()}(e),l.a.createElement(x,e)}})));r.a.render(P,document.getElementById("root"))}},[[219,1,2]]]);
//# sourceMappingURL=main.cbb72ba3.chunk.js.map